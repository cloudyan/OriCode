/* jQuery jtClite beta_v0.2 Last Updated: 2012-3-27 Author:CloudYan qq:1395093509 */
/*Cycle rolling*/
(function($){$.fn.jCarouselLite=function(o){o=$.extend({btnPrev:null,btnNext:null,btnGo:null,mouseWheel:false,auto:null,speed:200,easing:null,vertical:false,circular:true,visible:3,start:0,scroll:1,beforeStart:null,afterEnd:null},o||{});return this.each(function(){var b=false,animCss=o.vertical?"top":"left",sizeCss=o.vertical?"height":"width";var c=$(this),ul=$("ul",c),tLi=$("li",ul),tl=tLi.size(),v=o.visible;if(o.circular){ul.prepend(tLi.slice(tl-v-1+1).clone()).append(tLi.slice(0,v).clone());o.start+=v}var f=$("li",ul),itemLength=f.size(),curr=o.start;c.css("visibility","visible");f.css({overflow:"hidden",float:o.vertical?"none":"left"});ul.css({margin:"0",padding:"0",position:"relative","list-style-type":"none","z-index":"1"});c.css({overflow:"hidden",position:"relative","z-index":"2",left:"0px"});var g=o.vertical?height(f):width(f);var h=g*itemLength;var j=g*v;f.css({width:f.width(),height:f.height()});ul.css(sizeCss,h+"px").css(animCss,-(curr*g));c.css(sizeCss,j+"px");if(o.btnPrev)$(o.btnPrev).click(function(){return go(curr-o.scroll)});if(o.btnNext)$(o.btnNext).click(function(){return go(curr+o.scroll)});if(o.btnGo)$.each(o.btnGo,function(i,a){$(a).click(function(){return go(o.circular?o.visible+i:i)})});if(o.mouseWheel&&c.mousewheel)c.mousewheel(function(e,d){return d>0?go(curr-o.scroll):go(curr+o.scroll)});if(o.auto)setInterval(function(){go(curr+o.scroll)},o.auto+o.speed);function vis(){return f.slice(curr).slice(0,v)};function go(a){if(!b){if(o.beforeStart)o.beforeStart.call(this,vis());if(o.circular){if(a<=o.start-v-1){ul.css(animCss,-((itemLength-(v*2))*g)+"px");curr=a==o.start-v-1?itemLength-(v*2)-1:itemLength-(v*2)-o.scroll}else if(a>=itemLength-v+1){ul.css(animCss,-((v)*g)+"px");curr=a==itemLength-v+1?v+1:v+o.scroll}else curr=a}else{if(a<0||a>itemLength-v)return;else curr=a}b=true;ul.animate(animCss=="left"?{left:-(curr*g)}:{top:-(curr*g)},o.speed,o.easing,function(){if(o.afterEnd)o.afterEnd.call(this,vis());b=false});if(!o.circular){$(o.btnPrev+","+o.btnNext).removeClass("disabled");$((curr-o.scroll<0&&o.btnPrev)||(curr+o.scroll>itemLength-v&&o.btnNext)||[]).addClass("disabled")}}return false}})};function css(a,b){return parseInt($.css(a[0],b))||0};function width(a){return a[0].offsetWidth+css(a,'marginLeft')+css(a,'marginRight')};function height(a){return a[0].offsetHeight+css(a,'marginTop')+css(a,'marginBottom')}})(jQuery);
$(function(){
  //切换样式(采用参数调用形式，方便扩展)
	JS_tab_nav(".JS_tab_nav>li:lt(2)",".JS_tab_switch>.tabcon","selected","click");
	function JS_tab_nav(tab_nav,tab_con,selected,tri_type){
		$tab_obj=$(tab_nav);
		$tab_obj.bind(tri_type,function(){
			var tab_li_index = $(tab_nav).index(this);
			$(this).addClass(selected).siblings().removeClass(selected);
			$(tab_con).eq(tab_li_index).show().siblings().hide();
			});
	};
	$(".xhs_bj_to").click(function(){
		$(".xhs_bj").click();
		});
	
	//滚动控制
	$(".zt_scoll .scoll").jCarouselLite({
  	btnNext: ".zt_scoll .next",
  	btnPrev: ".zt_scoll .prev",
  	visible: 5,
  	scroll: 1,
		auto:1200,
  	speed: 500
  });
	
});

$(function(){
		var q_width=260,step_left=-780,len,icon_index=0,c_mt=0,num_len=0,select_len=0,cur_line_width=33;
		var $img=$("#step_con"),$dp_icon=$("#dp_icon"),$dp_tarea=$("#dp_tarea"),
		$Mask_layer=$("#c_overlay"),$cur_line=$(".cur_line");
		var com_int_val="【说出你对该景点的看法，打分完毕后提交】不少于20字";
		len=$("#step_con>li").length;
		/*刷新时重置*/
		$("#step_con").find(".c_answers").removeClass("c_answers_sd").removeAttr("disabled");
		$dp_tarea.val(com_int_val);
		
		if (!window.XMLHttpRequest){
			$Mask_layer.height($(document).height())
			}
	    $(window).scroll(function(){
					    var _scroll=$(document).scrollTop();
						if (!window.XMLHttpRequest){
							$(".com_tips").css({"top":_scroll+180});	
						}
						
		 });
		 
		/*取消离开按钮*/
		$(".btn_cancle").click(function(){
			$(this).parents(".com_tips").hide();
			$Mask_layer.hide();
		})
		/*确认离开按钮*/
		$(".btn_ensure").click(function(){
			$(this).parents(".com_tips").hide();
			$Mask_layer.hide();
			$dp_icon.find("i").removeClass("selected");
			$dp_tarea.removeClass("selected").val(com_int_val);
			$cur_line.css({"left":0});
			$img.css({"margin-left":0});
			$(".com_num_tips").css("visibility","hidden");
			$("#step_con").find(".c_answers").removeClass("c_answers_sd").removeAttr("disabled");
			$("#c_grade,.c_results").hide();
			$("#c_rk_img").show();
			
		})
		
		$(".c_answers").click(function(){
			 var $parent=$(this).parents("li"),_index=$("#step_con>li").index($parent);
			  icon_index=_index;
			 $(this).addClass("c_answers_sd").parents(".step").siblings(".c_results").show();;
			 $dp_icon.find("i").eq(icon_index).addClass("selected");
			 $parent.find(".c_answers").attr("disabled",true);
			 if(_index==len-1) return false;
			 cur_line("right");
			 $img.stop().animate({"margin-left":'-='+q_width},500);
			 
		});
		/*左边按钮点击事件*/
		$("#c_prev").click(function(){
			ques_slide("left");
		})
		/*右边按钮点击事件*/
		$("#c_next").click(function(){
			ques_slide("right");
		})
		
		
		/*左右箭头移上去添加激活状态样式*/
	    $("#c_prev").hover(function(){
				 $(this).addClass("c_prev_hr");
			},function(){
				$(this).removeClass("c_prev_hr");
				});
		$("#c_next").hover(function(){
				$(this).addClass("c_next_hr");
			},function(){
				$(this).removeClass("c_next_hr");
				});
			
		$("#c_rk_img,.hand").click(function(){
				$("#c_rk_img").hide();
				$cur_line.css({"left":0});
			    $img.css({"margin-left":0});
				$("#c_grade").show();
			});	
			
		/*点评输入框字数提示以及屏蔽敲回车键*/	
		$dp_tarea.focus(function(){
			 if($(this).val()==com_int_val) $(this).val("");
		  }).keydown(function(e){
			  if(e.keyCode==32) return false;
		  }).keyup(function(){
			 num_len=$dp_tarea.val().length;
			  $dp_tarea.addClass("selected");
			 $(".com_num_tips span").text(num_len);
			 $(".com_num_tips").css("visibility","visible");
		  }).blur(function(){
			   if($(this).val()=="") $(this).val(com_int_val);
			  
		  });  
		  			
		/*提交按钮*/		
		$("#dp_sumbit").click(function(){
			select_len=$("#c_remark").find(".selected").length;
			if(num_len<20){ $Mask_layer.show();$("#com_tips5").show(); return false;}
			if(select_len==5){$Mask_layer.show(); $("#com_tips1").show();}
			else {$Mask_layer.show();$("#com_tips4").show();}
			$(".com_num_tips").css("visibility","hidden");
		});

		  /*返回首页*/
		  $(".c_rn_link").click(function(){
			  com_submit();
		  });
		  
		/*横向滚动代码*/
		function ques_slide(method){
		   if( !$img.is(":animated") ){  
		  		 c_mt=parseInt($img.css('margin-left')); 
				if(method=="right"){
					if(c_mt>step_left){
					$img.animate({"margin-left":'-='+q_width},500);
					cur_line("right");
					}
					else  {com_submit();return false;}
				}else{
					if(c_mt<0){
						$img.animate({"margin-left":'+='+q_width},500);
						cur_line("left");
					}
					else {com_submit();return false;}
				}
			}	
		}
		/* 当前状态滑动代码*/
		function cur_line(method){ 
			method=="right"?$cur_line.animate({"left":'+='+cur_line_width},500):$cur_line.animate({"left":'-='+cur_line_width},500)
		
		}
		/*返回首页，左右按钮切换到第一屏（最后一屏）的代码*/
		function com_submit(){
			 select_len=$("#c_remark").find(".selected").length;
			if(select_len==0){
				$("#c_grade").hide();
				$("#c_rk_img").show();
			}else if(select_len==5){
				$("#com_tips2").show();
				$Mask_layer.show();
			}else{
				$("#com_tips3").show();
				$Mask_layer.show();
			}
			
		}
		
	});